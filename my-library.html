<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„æ›¸æˆ¿ - LibrarySystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .library-container {
            max-width: 1200px;
            margin: 40px auto;
            display: flex;
            gap: 30px;
            padding: 0 20px;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
            height: fit-content;
        }

        .sidebar h3 {
            padding-left: 20px;
            margin-bottom: 10px;
            color: #4285f4;
            font-size: 18px;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li {
            padding: 15px 20px;
            cursor: pointer;
            color: #555;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }

        .sidebar-menu li:hover {
            background-color: #f8f9fa;
            color: #4285f4;
        }

        .sidebar-menu li.active {
            background-color: #e8f0fe;
            color: #4285f4;
            border-left-color: #4285f4;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border-bottom: 1px solid #eee;
            padding: 15px;
            text-align: left;
        }

        th {
            background-color: #f9f9f9;
            color: #555;
        }

        .profile-form .form-group {
            margin-bottom: 20px;
        }

        .profile-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .profile-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <div class="nav-left">
            <h1 class="logo-title" id="logo-btn">Library System</h1>
        </div>
        <div class="nav-right">
            <a id="nav-home" href="index.html">é¦–é </a>
            <a href="popular.html">æ¨è–¦æ›¸ç±</a>
            <a href="my-library.html" class="auth-link">æˆ‘çš„æ›¸æˆ¿</a>
            <a href="about.html">ç¶²ç«™èªªæ˜</a>
            <a id="btn-login-trigger" class="login-btn">ç™»å…¥</a>
            <a id="user-display" class="hidden" style="font-weight:bold; color:#4285f4; cursor:default;"></a>
            <a id="btn-logout" class="hidden" style="color:#d9534f;">ç™»å‡º</a>
            <button id="theme-toggle" style="background:none; border:none; font-size:24px; cursor:pointer; margin-right:15px; display:flex; align-items:center;">ğŸŒ™</button>
        </div>
    </nav>

    <div class="library-container">
        <div class="sidebar">
            <h3>æˆ‘çš„æ›¸æˆ¿</h3>
            <ul class="sidebar-menu">
                <li id="menu-profile" onclick="switchSection('profile')" class="active">å€‹äººè³‡æ–™</li>
                <li id="menu-history" onclick="switchSection('history')">å€Ÿé–±ç´€éŒ„</li>
                <li id="menu-messages" onclick="switchSection('messages')">è¨Šæ¯é€šçŸ¥</li>
                <li id="menu-bookmarks" onclick="switchSection('bookmarks')">å€‹äººæ›¸ç±¤</li>
            </ul>
        </div>

        <div class="main-content">
            <div id="section-profile" class="content-section active">
                <h2 class="section-title">å€‹äººè³‡æ–™</h2>
                <div class="profile-form">
                    <div class="form-group"><label>å§“å</label><input type="text" value="ç‹å°æ˜" disabled
                            style="background:#f5f5f5;"></div>
                    <div class="form-group"><label>ç³»ç´š</label><input type="text" value="è³‡è¨Šç§‘å­¸ç³»" disabled
                            style="background:#f5f5f5;"></div>
                    <div class="form-group"><label>Email</label><input type="email"
                            placeholder="student@university.edu.tw"></div>
                    <div class="form-group"><label>è¯çµ¡é›»è©±</label><input type="tel" placeholder="09xx-xxx-xxx"></div>
                    <button
                        style="background:#4285f4; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer;">å„²å­˜ä¿®æ”¹</button>
                </div>
            </div>

            <div id="section-history" class="content-section">
                <h2 class="section-title">ç›®å‰å€Ÿé–±èˆ‡æ­·å²ç´€éŒ„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>æ›¸å</th>
                            <th>å€Ÿé–±æ—¥æœŸ</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                    </tbody>
                </table>
            </div>

            <div id="section-messages" class="content-section">
                <h2 class="section-title">è¨Šæ¯ä¸­å¿ƒ</h2>
                <p style="color:#999; text-align:center; margin-top:50px;">ç›®å‰æ²’æœ‰æ–°è¨Šæ¯</p>
            </div>

            <div id="section-bookmarks" class="content-section">
                <h2 class="section-title">æˆ‘çš„æ”¶è—æ›¸å–®</h2>
                <div id="bookmarks-container" style="display:flex; flex-wrap:wrap; gap:20px;"></div>
            </div>
        </div>
    </div>

    <div id="modal-login" class="modal hidden">
        <div class="modal-content login-modal-content">
            <span class="close-btn login-close">&times;</span>
            <h2>æœƒå“¡ç™»å…¥</h2>
            <div class="login-form">
                <div class="input-group"><input type="text" id="login-user" placeholder="è«‹è¼¸å…¥å­¸è™Ÿ/å¸³è™Ÿ"></div>
                <div class="input-group"><input type="password" id="login-pass" placeholder="è«‹è¼¸å…¥å¯†ç¢¼"></div>
                <button id="btn-login-submit">ç™»å…¥</button>
            </div>
        </div>
    </div>
    <div id="toast-container"></div>

    <script type="module" src="js/main.js"></script>
    <script>
        // åˆ‡æ›åˆ†é é‚è¼¯
        function switchSection(id) {
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById('menu-' + id).classList.add('active');
            document.getElementById('section-' + id).classList.add('active');

            if (id === 'bookmarks') {
                renderBookmarks();
            } else if (id === 'history') {
                renderHistory();
            }
        }

        // æ¸²æŸ“æ›¸ç±¤ (å·²ä¿®æ”¹ï¼šæ”¯æ´å·²å€Ÿé–±ç‹€æ…‹é¡¯ç¤º)
        function renderBookmarks() {
            const container = document.getElementById('bookmarks-container');
            const bookmarkList = JSON.parse(localStorage.getItem('library_bookmarked')) || [];
            // 1. è®€å–å€Ÿé–±ç´€éŒ„
            const borrowedList = JSON.parse(localStorage.getItem('library_borrowed')) || [];

            container.innerHTML = '';

            if (bookmarkList.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#666; width:100%;">ç›®å‰æ²’æœ‰æ”¶è—ä»»ä½•æ›¸ç±ã€‚</p>';
                return;
            }

            bookmarkList.forEach(book => {
                // 2. åˆ¤æ–·æ˜¯å¦å·²å€Ÿé–±
                const isBorrowed = borrowedList.some(b => b.id === book.id);

                const div = document.createElement('div');
                div.className = 'book-item';
                div.style.display = 'flex';
                div.style.flexDirection = 'column';
                div.style.justifyContent = 'space-between';
                div.style.border = '1px solid #eee';
                div.style.padding = '15px';
                div.style.borderRadius = '8px';

                // 3. æ ¹æ“šç‹€æ…‹åˆ‡æ›æŒ‰éˆ•æ¨£å¼èˆ‡æ–‡å­—
                div.innerHTML = `
                    <div style="flex-grow: 1; display: flex; flex-direction: column;"> 
                        <img src="${book.image}" alt="${book.title}" onerror="this.src='https://via.placeholder.com/150'" style="width:100%; height:200px; object-fit:contain; background-color: #f8f9fa;">
                        <h3 style="margin: 10px 0;">${book.title}</h3>
                        <div style="text-align: left; font-size: 14px; padding: 0 5px; color: #555;">
                            <p style="margin: 3px 0; color: #333;"><strong>ä½œè€…ï¼š</strong>${book.author}</p>
                            <p style="margin: 3px 0;"><strong>ISBNï¼š</strong>${book.isbn || 'ç„¡'}</p>
                        </div>
                    </div>
                    <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; width: 100%;">
                        <p style="color: #e4393c; font-weight: bold; font-size: 18px; margin: 0 0 10px 0;">$${book.price || 0}</p>
                        <div class="book-actions" style="display: flex; gap: 5px;">
                            <button class="${isBorrowed ? 'btn-borrow disabled' : 'btn-borrow'}" 
                                onclick="window.borrowBook('${book.id}')">
                                ${isBorrowed ? 'å·²å€Ÿé–±' : 'å€Ÿé–±'}
                            </button>
                            <button class="btn-bookmark active" onclick="window.toggleBookmark('${book.id}')" style="flex:1; padding:8px; background:#d9534f; color:white; border:1px solid #d9534f; border-radius:4px; cursor:pointer;">â™¥</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // æ¸²æŸ“å€Ÿé–±ç´€éŒ„
        function renderHistory() {
            const tbody = document.getElementById('history-table-body');
            const borrowedList = JSON.parse(localStorage.getItem('library_borrowed')) || [];

            tbody.innerHTML = '';

            if (borrowedList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">ç›®å‰æ²’æœ‰å€Ÿé–±ç´€éŒ„</td></tr>';
                return;
            }

            borrowedList.forEach(book => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.title}</td>
                    <td>${book.borrowDate || '2025-01-01'}</td>
                    <td><span style="color:#d9534f; font-weight:bold;">å€Ÿé–±ä¸­</span></td>
                    <td>
                        <button onclick="window.returnBook('${book.id}')" 
                        style="padding:5px 10px; background:#5cb85c; color:white; border:none; border-radius:4px; cursor:pointer;">
                        æ­¸é‚„
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // æ­¸é‚„åŠŸèƒ½
        window.returnBook = function (bookId) {
            if (confirm('ç¢ºå®šè¦æ­¸é‚„é€™æœ¬æ›¸å—ï¼Ÿ')) {
                let list = JSON.parse(localStorage.getItem('library_borrowed')) || [];
                list = list.filter(b => b.id !== bookId);
                localStorage.setItem('library_borrowed', JSON.stringify(list));
                renderHistory();
                window.showToast('æ­¸é‚„æˆåŠŸï¼', 'success');
            }
        }

        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            renderHistory();

            const u = localStorage.getItem('library_user');
            if (u) {
                const userDisplay = document.getElementById('user-display');
                if (userDisplay) {
                    userDisplay.textContent = u + " æ‚¨å¥½";
                    userDisplay.classList.remove('hidden');
                }
                document.getElementById('btn-login-trigger')?.classList.add('hidden');
                document.getElementById('btn-logout')?.classList.remove('hidden');
            }
        });
    </script>

    <script src="js/dark-mode.js"></script>
</body>

</html>