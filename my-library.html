<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>我的書房 - LibrarySystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .library-container {
            max-width: 1200px;
            margin: 40px auto;
            display: flex;
            gap: 30px;
            padding: 0 20px;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
            height: fit-content;
        }

        .sidebar h3 {
            padding-left: 20px;
            margin-bottom: 10px;
            color: #4285f4;
            font-size: 18px;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li {
            padding: 15px 20px;
            cursor: pointer;
            color: #555;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }

        .sidebar-menu li:hover {
            background-color: #f8f9fa;
            color: #4285f4;
        }

        .sidebar-menu li.active {
            background-color: #e8f0fe;
            color: #4285f4;
            border-left-color: #4285f4;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border-bottom: 1px solid #eee;
            padding: 15px;
            text-align: left;
        }

        th {
            background-color: #f9f9f9;
            color: #555;
        }

        .profile-form .form-group {
            margin-bottom: 20px;
        }

        .profile-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .profile-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <div class="nav-left">
            <h1 class="logo-title" id="logo-btn">Library System</h1>
        </div>
        <div class="nav-right">
            <a id="nav-home" href="index.html">首頁</a>
            <a href="popular.html">熱門圖書</a>
            <a href="my-library.html" class="auth-link">我的書房</a>
            <a href="about.html">網站說明</a>
            <a id="btn-login-trigger" class="login-btn">登入</a>
            <a id="user-display" class="hidden" style="font-weight:bold; color:#4285f4; cursor:default;"></a>
            <a id="btn-logout" class="hidden" style="color:#d9534f;">登出</a>
        </div>
    </nav>

    <div class="library-container">
        <div class="sidebar">
            <h3>我的書房</h3>
            <ul class="sidebar-menu">
                <li id="menu-profile" onclick="switchSection('profile')" class="active">個人資料</li>
                <li id="menu-history" onclick="switchSection('history')">借閱紀錄</li>
                <li id="menu-messages" onclick="switchSection('messages')">訊息通知</li>
                <li id="menu-bookmarks" onclick="switchSection('bookmarks')">個人書籤</li>
            </ul>
        </div>

        <div class="main-content">
            <div id="section-profile" class="content-section active">
                <h2 class="section-title">個人資料</h2>
                <div class="profile-form">
                    <div class="form-group"><label>姓名</label><input type="text" value="王小明" disabled
                            style="background:#f5f5f5;"></div>
                    <div class="form-group"><label>系級</label><input type="text" value="資訊科學系" disabled
                            style="background:#f5f5f5;"></div>
                    <div class="form-group"><label>Email</label><input type="email"
                            placeholder="student@university.edu.tw"></div>
                    <div class="form-group"><label>聯絡電話</label><input type="tel" placeholder="09xx-xxx-xxx"></div>
                    <button
                        style="background:#4285f4; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer;">儲存修改</button>
                </div>
            </div>

            <div id="section-history" class="content-section">
                <h2 class="section-title">目前借閱與歷史紀錄</h2>
                <table>
                    <thead>
                        <tr>
                            <th>書名</th>
                            <th>借閱日期</th>
                            <th>狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body"></tbody>
                </table>
            </div>

            <div id="section-messages" class="content-section">
                <h2 class="section-title">訊息中心</h2>
                <p style="color:#999; text-align:center; margin-top:50px;">目前沒有新訊息</p>
            </div>

            <div id="section-bookmarks" class="content-section">
                <h2 class="section-title">我的收藏書單</h2>
                <div id="bookmarks-container" style="display:flex; flex-wrap:wrap; gap:20px;"></div>
            </div>
        </div>
    </div>

    <div id="modal-login" class="modal hidden">
        <div class="modal-content login-modal-content">
            <span class="close-btn login-close">&times;</span>
            <h2>會員登入</h2>
            <div class="login-form">
                <div class="input-group"><input type="text" id="login-user" placeholder="請輸入學號/帳號"></div>
                <div class="input-group"><input type="password" id="login-pass" placeholder="請輸入密碼"></div>
                <button id="btn-login-submit">登入</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        // --- 1. 分頁切換功能 ---
        function switchSection(id) {
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById('menu-' + id).classList.add('active');
            document.getElementById('section-' + id).classList.add('active');

            // 如果切換到借閱紀錄，重新渲染一次確保最新
            if (id === 'history') renderBorrowHistory();
        }

        // --- 2. 核心：渲染借閱紀錄 ---
        function renderBorrowHistory() {
            const tableBody = document.getElementById('history-table-body');
            if (!tableBody) return;

            // 從 localStorage 讀取資料
            const borrowedList = JSON.parse(localStorage.getItem('library_borrowed')) || [];

            if (borrowedList.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px; color:#999;">目前沒有借閱中的書籍</td></tr>';
                return;
            }

            tableBody.innerHTML = '';
            borrowedList.forEach(book => {
                const today = new Date().toLocaleDateString();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div style="display:flex; align-items:center; gap:12px;">
                            <img src="${book.image}" style="width:45px; height:60px; object-fit:cover; border-radius:4px; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                            <div>
                                <div style="font-weight:bold; color:#333;">${book.title}</div>
                                <div style="font-size:11px; color:#999;">ISBN: ${book.isbn}</div>
                            </div>
                        </div>
                    </td>
                    <td style="color:#666;">${today}</td>
                    <td><span style="background:#e8f0fe; color:#4285f4; padding:4px 10px; border-radius:20px; font-size:12px; font-weight:bold;">借閱中</span></td>
                    <td>
                        <button onclick="returnBook('${book.id}')" 
                            style="background:#feeef0; color:#d93025; border:1px solid #fad2cf; padding:6px 14px; border-radius:4px; cursor:pointer; font-size:13px; font-weight:bold;">
                            歸還
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // --- 3. 歸還功能 ---
        window.returnBook = function (bookId) {
            if (confirm('確定要歸還這本書嗎？')) {
                let list = JSON.parse(localStorage.getItem('library_borrowed')) || [];
                list = list.filter(b => b.id !== bookId);
                localStorage.setItem('library_borrowed', JSON.stringify(list));
                renderBorrowHistory();
                alert('歸還成功！');
            }
        }

        // --- 4. 初始化 ---
        window.addEventListener('DOMContentLoaded', () => {
            renderBorrowHistory();

            // 檢查登入顯示
            const u = localStorage.getItem('library_user');
            if (u) {
                const userDisplay = document.getElementById('user-display');
                if (userDisplay) {
                    userDisplay.textContent = u + " 您好";
                    userDisplay.classList.remove('hidden');
                }
                document.getElementById('btn-login-trigger')?.classList.add('hidden');
                document.getElementById('btn-logout')?.classList.remove('hidden');
            }
        });
    </script>
</body>

</html>